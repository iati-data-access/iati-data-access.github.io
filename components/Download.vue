<template>
  <div :class="containerClass">
    <template v-if="preparingFile">
      <b-btn variant="secondary" :size="size" @click.prevent="getActivitiesFile" :href="url">
        <b-spinner label="Preparing" small></b-spinner> {{ $t('translations.preparingFile') }}
      </b-btn>
    </template>
    <template v-else>
      <b-btn :variant="variant" @click.prevent="getActivitiesFile" :href="url" :size="size" id="dl-btn">
        <font-awesome-icon :icon="icon" /> {{ label }}
      </b-btn>
    </template>
  </div>
</template>
<script>
import axios from 'axios'
import { saveAs } from 'file-saver'
export default {
  data() {
    return {
      preparingFile: false
    }
  },
  props: {
    'label': String,
    'variant': String,
    'file-name': String,
    'url': String,
    'size': {
      type: String,
      default: null
    },
    'icon': {
      type: Array,
      default: function () {
        return ['fa', 'download']
      }
    },
    'container-class': {
      type: String,
      default: null
    },
  },
  methods: {
    async getActivitiesFile() {
      this.preparingFile = true
      await axios.get(this.url, {method: 'GET',
        responseType: 'blob'}).then(response => {
        if (response.status === 200) {
          saveAs(
            new Blob([response.data]),
            this.fileName
          )
        } else if (response.status === 500) {
          this.$bvToast.toast(`Sorry, something went wrong, and the file could not be downloaded.`, {
            title: "Error.",
            variant: "danger"
          })
        }
      })
      .catch(error => {
        this.$bvToast.toast(`Sorry, something went wrong, and the file could not be downloaded.`, {
          title: "Error.",
          variant: "danger"
        })
      })
      this.preparingFile = false
    }
  }
}
</script>
